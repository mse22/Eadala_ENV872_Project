---
title: "Analysis of nutrients and factors essential for the maintenance of lake water quality in Wisconsin"
author: "Monisha Eadala"
geometry: margin=2.54cm
output:
  pdf_document:
    fig_caption: yes
    keep_tex: yes
    number_sections: yes
  word_document: default
mainfont: Times New Roman
subtitle: https://github.com/mse22/Eadala_ENV872_Project 
fontsize: 12pt
---

\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r setup, include=FALSE}

setwd("~/Eadala_Project_Environmental_Data_Analytics")
# Load my packages
library(tidyverse)
library(knitr)
# Set my ggplot theme
mytheme <- theme_light(base_size = 12) +
  theme(plot.background = element_rect(fill = "grey97"),
        panel.grid.major =element_line(linetype = "dotted"),
        panel.grid.minor = element_line(linetype = "dotted"), text=element_text(size = 14, 
color = "black", face = "bold"),
        axis.text = element_text(color = "grey40"), 
        legend.position = "right",
        legend.text = element_text(color = "grey40"))
theme_set(mytheme)

```


# Rationale and Research Questions

The measurement of eutrophication is not an easy task. The aquatic ecosystem is very complex by constant interactions between physical, chemical and biological components. There are several indicators available to assess the degree of eutrophication. Nutrients such as phosphorus, phosphate, nitrogen and nitrates are the main elements that can be analyzed since high concentrations of these nutrients will mean more algae growth.

The presence of sufficient dissolved oxygen in the water column is very important for all aquatic life. Eutrophic waters (rich in nutrients) have fluctuating amounts of dissolved oxygen. Algae consume oxygen. A great algal biomass can therefore provide very low concentrations of oxygen in the water, sometimes so low that even fish can not survive and die.

Therefore, I hope to analyze variables such as total nitrogen, total phosphorus, dissolved oxygen, depth, temperature (in Celsius), months, days and years to better understand aspects of the eutrophication and lake water quality in general.

Research question 1:
Have the lakes been within the limiting nutrient criteria over the years? How does the N:P ratio impact the dissolved oxygen in the lakes?

Research question 2: What are the best set of predictors of dissolved oxygen across the monitoring period at the North Temperate Lakes LTER

\newpage

# Dataset Information

The datasets in this repository contain data from studies on several lakes in the North Temperate Lakes District in Wisconsin, USA. Data were collected as part of the Long Term Ecological Research station established by the National Science Foundation. 

Data were collected from the North Temperate Lakes Long Term Ecological Research website (https://lter.limnology.wisc.edu/about/overview). Data were collected using the Data tool on the website (https://lter.limnology.wisc.edu/data).

From the Data homepage, the following were typed and searched: 
1. *Cascade Project at North Temperate Lakes LTER Core Data Physical and Chemical Limnology 1984 - 2016*
2. *Cascade Project at North Temperate Lakes LTER Core Data Nutrients 1991 - 2016*

Each of relevant files were downloaded through "Download All Data (csv)" button. 

The two raw datasets relevant to my project are:

1. 'NTL-LTER_Lake_ChemistryPhysics_Raw.csv' file: This contains data relevant to physical and chemical variables (such as temperature, dissolved oxygen, and irradiance) that are measured at one central station near the deepest point of each lake. In most cases these measurements are made in the morning (8 to 9 am). Vertical profiles are taken at varied depth intervals. Chemical measurements are sometimes made in a pooled mixed layer sample (PML); sometimes in the epilimnion, metalimnion, and hypolimnion; and sometimes in vertical profiles. In the latter case, depths for sampling usually correspond to the surface plus depths of 50%, 25%, 10%, 5% and 1% of surface irradiance. (As noted in https://portal.edirepository.org/nis/metadataviewer?packageid=knb-lter-ntl.352.3)

This dataset contains the below column names and their relevant details:

Column Name       | Class     | Units   | Relevant Dataset Information
------------------|-----------|---------|-----------------------------
lakeid            | factor    | -       | Provides the IDs of the lakes either in the form of capital letters or words; for example, L, R, T, E, Tbog, Roach, Ward, etc. 
lakename          | factor    | -       | Provides the names of the lakes; for example, Paul Lake, Peter Lake, Tuesday Lake, East Long Lake, etc.
year4             | integer   | -       | Provides the year in which its respective data was collected in four digits from 1984 to 2016
daynum            | integer   | -       | Provides the number of the day on which its data was collected from from 1 to 366
sampledate        | factor    | -       | Provides the date on which its data was collected in m/d/y format
depth             | numeric   | m       | Provides the depth at which the data sample was collected in meters
temperature_C     | numeric   | C       | Provides the water temperature in Celsius
dissolvedOxygen   | numeric   | mg/L    | Provides the dissolved oxygen measurement in milligrams per liter
irradianceWater   | numeric   | uE      | Provides the photosynthetically active radiation measured in the water column in micro-Einstein 
irradianceDeck    | numeric   | uE      | Provides the photosynthetically active radiation measured on the deck of the sampling boat in micro-Einstein
comments          | factor    | -       | Provides the comments noting departure from standard procedure 

Table: Chemistry-Physics Dataset Content

2. 'NTL-LTER_Lake_Nutrients_Raw.csv' file: This contains the data relevant to physical and chemical variables (such as total nitrogen, total phosphorus, ammonia and ammonium, nitrite and nitrate, and phosphate concentrations) that are measured at one central station near the deepest point of each lake. In most cases these measurements are made in the morning (8 to 9 am). Vertical profiles are taken at varied depth intervals. Chemical measurements are sometimes made in a pooled mixed layer sample (PML); sometimes in the epilimnion, metalimnion, and hypolimnion; and sometimes in vertical profiles. In the latter case, depths for sampling usually correspond to the surface plus depths of 50%, 25%, 10%, 5% and 1%t of surface irradiance. The 1991-1999 chemistry data was obtained from the Lachat auto-analyzer. Like the process data, there are up to seven samples per sampling date due to Van Dorn collections across a depth interval according to percent irradiance. Voichick and LeBouton (1994) describe the autoanalyzer procedures in detail. Nutrient samples were sent to the Cary Institute of Ecosystem Studies for analysis beginning in 2000. The Kjeldahl method for measuring nitrogen is not used at IES, and so measurements reported from 2000 onwards are Total Nitrogen. (As noted in https://portal.edirepository.org/nis/metadataviewer?packageid=knb-lter-ntl.351.3)

This dataset contains the below column names and their relevant details:

Column Name        | Class    | Units   | Relevant Dataset Information
-------------------|----------|---------|-----------------------------
lakeid             | factor   | -       | Provides the IDs of the lakes either in the form of capital letters or words; for example, L, R, T, E, Tbog, Roach, Ward, etc. 
lakename           | factor   | -       | Provides the names of the lakes; for example, Paul Lake, Peter Lake, Tuesday Lake, East Long Lake, etc.
year4              | integer  | -       | Provides the year in which its respective data was collected in four digits from 1991 to 2016
daynum             | integer  | -       | Provides the number of the day on which its data was collected from from 1 to 366
sampledate         | factor   | -       | Provides the date on which its data was collected in m/d/y format
depth_id           | integer  | -       | Provides the depth level categorized from -2 to 7; 1 represents 100% light, 2 represents 50% light, 3 represents 25% light; 4 represents 10% light, 5 represents 5% light, 6 represents 1% light, 7 means Hypolimnion, -1 means Epilimnion/PML, and -2 means Metalimnion
depth              | numeric  | m       | Provides the depth at which the data sample was collected in meters
tn_ug              | numeric  | ug/L    | Provides the total nitrogen concentration in micrograms per liter
tp_ug              | numeric  | ug/L    | Provides the total phosphorus concentration in micrograms per liter
nh34               | numeric  | ug/L    | Provides the ammonia and ammonium concentration in micrograms per liter
no23               | numeric  | ug/L    | Provides the nitrite and nitrate concentration in micrograms per liter
po4                | numeric  | ug/L    | Provides the phosphate concentration in micrograms per liter
comments           | factor   | -       | Provides any additional comments

Table: Nutrients Dataset Content

*Wrangling Process from raw to processed data:*

The raw data were first explored to understand list of unique columns and rows each contains. Then a call was made to only include columns and data that was available in both the datasets since I intended to combine the two datasets to analyse how elements from the chemistry-physics dataset are impacted by the nutrients in the nutrients dataset. So the chosen years were 1991-20016 since they were available in both the datasets. Similarly, only 6 lakes that were common in both the datasets were selected. Selection was also made based on the quantity of data available for each one of the lakes. Lakes that have very little data available were excluded from the combined processed dataset even though they were common to both the nutrients and the chemistry-physics datasets.

Also, since combining two datasets means more number NAs, I decided to only study selected variables available in both the datasets. For example, I chose not to study the phosphates, nitrates/nitrites and ammonia/ammonium variables from the nutrient dataset to minimize the number of the NAs that might show up in the combined processed dataset. Therefore, I choose to focus on nitrogen (TN) and phosphorus (TP) concentrations along with other physical variables such are days and depth in the nutrients data. Similarly, I choose not to include both the irradiance variables and instead focus on dissolved oxygen and temperature in the chemistry-physics dataset. Data was also wrangled to include a new column, N:P, to understand the nutrient limitations and efficient water management techniques. This was done initially in the data exploring stage and purposes of the project itself.  

\newpage

# Exploratory Analysis 

```{r, message=FALSE, warning=FALSE}

# Read in nutrients data
Nutrients_raw <- read.csv("./Data/Raw/NTL-LTER_Lake_Nutrients_Raw.csv")
# Read in chemistry-physics data
ChemistryPhysics_raw <- read.csv("./Data/Raw/NTL-LTER_Lake_ChemistryPhysics_Raw.csv")

# Format Dates
Nutrients_raw$sampledate <- as.Date(Nutrients_raw$sampledate,
format = "%m/%d/%y")
ChemistryPhysics_raw$sampledate <- as.Date(ChemistryPhysics_raw$sampledate,
format = "%m/%d/%y")

```

Data exploration of the nutrients and chemistry-physics raw data files associated with NTL-LTER lakes.

```{r, message=FALSE, warning=FALSE}

dim(Nutrients_raw)
dim(ChemistryPhysics_raw)
str(Nutrients_raw)
str(ChemistryPhysics_raw)
colnames(Nutrients_raw)
colnames(ChemistryPhysics_raw)
summary(Nutrients_raw)
summary(ChemistryPhysics_raw)

```

Visual data exploration of the nutrients data raw file in Figure 1, Figure 2, and Figure 3.

```{r fig1, echo=FALSE,error=FALSE,message=FALSE,warning=FALSE,fig.cap="Nitrogen concentration frequency polygon."}

TN.FreqPol.plot <- ggplot(Nutrients_raw) +
  geom_freqpoly(aes(x = tn_ug, color = lakename), bins = 50) +
    theme(axis.text=element_text(size=11),
        axis.title=element_text(size=11,face="bold")) + 
  ggtitle("Exploratory Frequency Polygon") + # To insert the main title
  theme(plot.title = element_text(size = 12, face = "bold", hjust = 0.5)) +
  theme(legend.title = element_text(size = 9), legend.text = element_text(size = 7)) +
  xlab("Total Nitrogen Concentration (µg/l)") + # To label the x axis
  ylab("Count") + # To label the y axis
  labs (color = "Lake Name") # To label the legend
print(TN.FreqPol.plot)

```

```{r fig2, echo=FALSE,error=FALSE,message=FALSE,warning=FALSE,fig.cap="Nitrogen concentration boxplot."}

TN.Box.plot <- ggplot(Nutrients_raw) +
  geom_boxplot(aes(x = lakename, y = tn_ug, color = lakename)) +
  theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
  theme(legend.position="none") + # To removes the legend
  ggtitle("Exploratory Boxplot") + # To insert the main title
  theme(plot.title = element_text(size = 14, face = "bold", hjust = 0.5)) +
  xlab("Lake Name") + # To label the x axis
  ylab("TN (µg/l)") # To label the y axis
print(TN.Box.plot)

```

```{r fig3, echo=FALSE,error=FALSE,message=FALSE,warning=FALSE,fig.cap="Nitrogen concentration scatterplot."}

TN.Scatter.plot <- ggplot(Nutrients_raw, aes(x = sampledate, y = tn_ug, color = lakename)) +
  geom_point() +
  stat_smooth(color = "black") +
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12,face="bold")) + 
  theme(legend.title = element_text(size = 9), legend.text = element_text(size = 7)) +
  ggtitle("Exploratory Scatterplot") + # To insert the main title
  theme(plot.title = element_text(size = 14, face = "bold", hjust = 0.5)) +
  xlab("Date") + # To label the x axis
  ylab("TN (µg/l)") + # To label the y axis
  labs (color = "Lake Name") # To label the legend
print(TN.Scatter.plot)

```

Visual data exploration of the chemistry-physics data raw file in Figure 4.

```{r fig4, echo=FALSE,error=FALSE,message=FALSE,warning=FALSE,fig.cap="Dissolved oxygen scatterplot."}

DO.Scatter.plot <- ggplot(ChemistryPhysics_raw, aes(x = sampledate, y = dissolvedOxygen, color = lakename)) +
  geom_point() +
  stat_smooth(color = "black") +
  ylim(0,25) + # To remove the outliers
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12,face="bold")) + 
  ggtitle("Exploratory Scatterplot") + # To insert the main title
  theme(plot.title = element_text(size = 14, face = "bold", hjust = 0.5)) +
  theme(legend.title = element_text(size = 10), legend.text = element_text(size = 9)) +
  xlab("Date") + # To label the x axis
  ylab("Dissolved Oxygen (mg/L)") + # To label the y axis
  labs (color = "Lake Name") # To label the legend
print(DO.Scatter.plot)

```

Wrangling of data to include only the most meaningful variables and compatible data for combining the two datasets.

```{r, message=FALSE, warning=FALSE}

# Find out what years are included in the chemistry-physics dataset
list(unique(ChemistryPhysics_raw$year4))

# Find out what years are included in the Nutrients dataset
list(unique(Nutrients_raw$year4))

# Keep only useful columns to minimize the number of NAs later and filter only the years that are common to both datasets
Nutrients_processed <- Nutrients_raw %>%
  select(-lakeid, -depth_id , -nh34, -no23, -po4, -comments) %>%
  filter(year4 == 1991 | year4 == 1992 | year4 ==  1993 | year4 ==  1994 | year4 == 1999 | year4 ==  2000 | year4 == 2001 | year4 == 2002 | year4 == 2003 | year4 == 2005 | year4 ==  2006 | year4 == 2007| year4 == 2008 | year4 == 2009 | year4 == 2010 | year4 ==  2011 | year4 ==  2012 | year4 ==  2013 | year4 ==  2014 | year4 == 2015 | year4 == 2016) 

# Keep only useful columns to minimize the number of NAs later and filter only the years that are common to both datasets
ChemistryPhysics_processed <- ChemistryPhysics_raw %>%
  select(-lakeid, -irradianceDeck, -irradianceWater, -comments) %>% 
  filter(year4 == 1991 | year4 == 1992 | year4 ==  1993 | year4 ==  1994 | year4 == 1999 | year4 ==  2000 | year4 == 2001 | year4 == 2002 | year4 == 2003 | year4 == 2005 | year4 ==  2006 | year4 == 2007| year4 == 2008 | year4 == 2009 | year4 == 2010 | year4 ==  2011 | year4 ==  2012 | year4 ==  2013 | year4 ==  2014 | year4 == 2015 | year4 == 2016)

# List the unique lake names in the processed nutrients dataset
list(unique(Nutrients_processed$lakename))

# List the unique lake names in the processed chemistry-physics dataset
list(unique(ChemistryPhysics_processed$lakename))

# Combine the two datasets and filter only the common and interested lakes from the two datasets
Combined_processed <- full_join(Nutrients_processed, ChemistryPhysics_processed) %>%
  filter(year4 == 1991 | year4 == 1992 | year4 ==  1993 | year4 ==  1994 | year4 == 1999 | year4 ==  2000 | year4 == 2001 | year4 == 2002 | year4 == 2003 | year4 == 2005 | year4 ==  2006 | year4 == 2007| year4 == 2008 | year4 == 2009 | year4 == 2010 | year4 ==  2011 | year4 ==  2012 | year4 ==  2013 | year4 ==  2014 | year4 == 2015 | year4 == 2016) %>%
  filter(lakename == "Paul Lake" | lakename == "Peter Lake" | lakename == "East Long Lake" | lakename == "West Long Lake" | lakename == "Tuesday Lake" | lakename == "Crampton Lake")

# Save the combined data in the processed folder
write.csv(Combined_processed, row.names = FALSE, file = "./Data/Processed/Combined_processed.csv")

```

A Redfield ratio N:P of 16:1 by moles in general indicates a roughly balanced supply of N and P, and algae assemblages tend to mirror this ratio fairly closely when growing under balanced growth conditions (https://www.sciencedirect.com/topics/earth-and-planetary-sciences/redfield-ratio). Converting the molar ratio to migrogram ratio gives us N:P of 7.24:1, since 1 mole of N = 14.0067g and 1 mole of P = 30.973761g (https://www.convertunits.com/from/grams+Nitrogen/to/moles; https://www.convertunits.com/from/grams+Phosphorus/to/moles)

First question for further data exploring: *Are the lakes phosphorus or nitrogen deficient?*

```{r, message=FALSE, warning=FALSE}

#To exlude some of the valariables from the dataset so that the number of NAs in the dataset could be minimized
NitrogenPhosphorus <- Combined_processed %>%
  select(-temperature_C) %>%
  na.exclude()

# Save the new folder
write.csv(NitrogenPhosphorus, row.names = FALSE, file = "./Data/Processed/NitrogenPhosphorus_processed.csv")

```

```{r, include=FALSE}

NP.plot <- ggplot(NitrogenPhosphorus, aes(x = tp_ug, y = tn_ug, color = lakename)) +
  geom_point(alpha = 0.75) +
  geom_abline(slope = 7.24, intercept = 0, linetype = "dashed") +
  annotate("text", x = 40, y = 30 * 7.24, angle = atan(7.24 * 4) * 35/pi, label = "Redfield Ratio", size = 3) +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  scale_color_brewer(palette = "Set1", direction = 1) +
  ggtitle("(a)") + # To insert the main title
  theme(plot.title = element_text(size = 14, face = "bold")) +
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12,face="bold")) + 
  theme(legend.title = element_text(size = 12), legend.text=element_text(size=12)) +
  xlab("P (µg/l)") + # To label the x axis
  ylab("N (µg/l)") + # To label the y axis
  labs (color = "Lake Name") + # To label the legend
  xlim(0,65)
print(NP.plot) # Gives the N vs P plot; Tells us that most of the lakes are phosphorus deficient, therefore phosphorus should be the limiting nutrient addressed in the water management

```

*What is the average total nitrogen/total phosphorus (N:P) ratio for each of the six north temperate lakes?*

```{r, message=FALSE, warning=FALSE}

NitrogenPhosphorus$NPRatio <- NitrogenPhosphorus$tn_ug / NitrogenPhosphorus$tp_ug # Gives us a new colum with the N:P ratio

# To summarize the N:P ratio in each lake 
NPRatio.summary <- NitrogenPhosphorus %>%
   group_by(lakename) %>%
  summarise(mean.NPRatio = mean(NPRatio, na.rm = TRUE),
            minimum.NPRatio = min(NPRatio, na.rm = TRUE),
            maximum.NPRatio = max(NPRatio, na.rm = TRUE),
            Standard.dev.NPRatio = sd(NPRatio, na.rm = TRUE)) # Gives us summary stats of each of the lakes with respect to N:P

```

```{r, include=FALSE}

NPRatio.boxplot <- ggplot(NitrogenPhosphorus, aes(x = depth, y = NPRatio)) +
  geom_boxplot(aes(color = lakename)) +
  scale_color_brewer(palette = "Set1", direction = 1) +
  geom_hline(yintercept = 7.24, linetype = "dashed") +
  annotate("text", x=4, y=2, label="Redfield Ratio", size = 3) +
  ggtitle("(b)") + # To insert the main title 
  theme(plot.title = element_text(size = 14, face = "bold")) +
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12,face="bold")) + 
  theme(legend.title = element_text(size = 12), legend.text=element_text(size=12)) +
  xlab("Depth (m)") + # To label the x axis
  ylab("N:P") + # To label the y axis
  labs (color = "Lake Name") + # To label the legend
  ylim(0,200)
print(NPRatio.boxplot) # Gives us the individual boxplots of the lakes with respect to their N:P

```

Figure 5 offers a visual to understand if most of the lakes are above or below the Redfield Ratio. In other words, to understand if most of the lakes are phosphorus or nitrogen limited. 

Dashed line indicates the Redfield Ratio of 7.24:1, which indicates optimal conditions for phytoplankton growth. The lakes above the Redfield Ratio would be phosphorus limited while those below it would be nitrogen limited. 

```{r fig5, echo=FALSE,error=FALSE,message=FALSE,warning=FALSE,fig.cap="(a) Nitrogen vs phosphorus concentration (b) Distribution of N:P Ratio."}

# To combines the above two figures
library(cowplot)

NP.plot = NP.plot + theme(legend.position="none") # Removes the legend from the plot
NPRatio.boxplot = NPRatio.boxplot + theme(legend.position ="right", legend.title = element_text(size = 7), legend.text = element_text(size = 7)) # Asserts the position of the legend on the right side of the plot
plot_grid(NP.plot, NPRatio.boxplot, nrow = 1, align = 'h', rel_widths = c(1, 1.45)) # Combines all the three plots

```

Figure 5 Tells us that most of the Lakes are phosphorus deficient, therefore phosphorus should be the limiting nutrient prioritized or addressed during water management.


\newpage

# Analysis

## Question 1: Have the lakes been within the limiting nutrient criteria over the years? How does the N:P ratio impact the dissolved oxygen in the lakes?

*One-sample t-test* 

The figures under exploratory analysis tell us that all the eight lakes are phosphorus deficient, and therefore phosphorus is the element that needs to be controlled on priority to avoid eutrophication. EPA has compiled state, territorial, and authorized tribal water quality standards that EPA has approved or are otherwise in effect for Clean Water Act purposes. According to this compilation, Wisconsin's stratified lakes' total phosphorus criterion is not more than 30µg/l (https://www.epa.gov/wqs-tech/state-specific-water-quality-standards-effective-under-clean-water-act-cwa#tb2). According to Carlson R.E. and J. Simpson in 1996, phosphorus concentration between 24µg/l and 96µg/l suggests eutrophic conditions, and anything above 96µg/l suggests hypereutrophic conditions (https://en.wikipedia.org/wiki/Trophic_state_index). Therefore, it is important to check if the eight North Temperate Lakes are at least within the 30µg/l criterion or not. 

This statistical analysis will test the null hypothesis that the means of the total phosphorus concentrations in the eight North Temperate Lakes are below the regulatory standard of 30µg/l.

First, the assumption of normal distribution is evaluated through the Shapiro-Wilk normality test.

```{r, message=FALSE, warning=FALSE}

shapiro.test(NitrogenPhosphorus$tp_ug)

```

The Shapiro-Wilk normality test says that the total phosphorus concentrations data in the six lakes of Wisconsin are significantly different from a normal distribution (Shapiro-Wilk normality test; W = 0.69337, p-value < 0.0001)

Next, a visual analysis of the data is performed.

```{r, message=FALSE, warning=FALSE}

hist(NitrogenPhosphorus$tp_ug, breaks = 50) # Phosphorus concentration histogram

qqnorm(NitrogenPhosphorus$tp_ug, pch = 1, frame = FALSE)
qqline(NitrogenPhosphorus$tp_ug, col = "blue", lwd = 2)

```

In the above figures it can be seen that the data distribution is right-skewed with a longer tail to the right than a normal distribution; nevertheless, environmental data often violate the assumptions of normality and since the sample size is large, a t-test is performed anyway.

```{r, message=FALSE, warning=FALSE}

t.test(NitrogenPhosphorus$tp_ug, mu = 30, alternative = "less")

```

According to the One Sample t-test, the TP concentrations for the North Temperate Lakes of Wisconsin from 1991 to 2016 have not been significantly lower than 30µg/l (one sample t-test; t = 3.2053, df = 907, p-value > 0.0001).

Figure 6 presents a visualization of the TP concentrations in Wisconsin lakes data in comparison with the Wisconsin regulatory standard.

```{r fig6, echo=FALSE,error=FALSE,message=FALSE,warning=FALSE,fig.cap="Phosphorus concenration over years."}

TPvsCriterion <- ggplot(NitrogenPhosphorus, aes(x = year4, y = tp_ug, color = lakename)) +
  geom_point(alpha = 0.75) +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  geom_hline(yintercept = 30, linetype = "dashed") +
  annotate("text", x=2008, y=38, label="Phosphorus Criterion = 30µg/l", size = 3) +
  scale_color_brewer(palette = "Set1", direction = 1) +
    theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12,face="bold")) + 
  theme(legend.title = element_text(size = 11), legend.text = element_text(size = 10)) +
    xlab("Years") + # To label the x axis
  ylab("P (µg/l)") + # To label the y axis
  labs (color = "Lake Name") # To label the legend
print(TPvsCriterion) # This presents a visualization of the TP concentrations in Wisconsin lakes data in comparison with the Wisconsin regulatory standard.

```

The blue line in comparison with the black dashed line indicates that most of the Wisconsin lakes started off with phosphorus levels above the criteria but have been able to lower their phosphorus in the most recent recent years.

Coming the the next part of the research question, figure 7 gives us the visual interpretation of how the N:P ratio affects the dissolved oxygen.

```{r fig7, echo=FALSE,error=FALSE,message=FALSE,warning=FALSE,fig.cap="Dissolved oxygen over N:P ratio"}

NPRatio.plot <- ggplot(NitrogenPhosphorus, aes(x = NPRatio, y = dissolvedOxygen, color = lakename)) +
  geom_point(alpha = 0.75) +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  scale_color_brewer(palette = "Set1", direction = 1) +
    theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12,face="bold")) + 
  theme(legend.title = element_text(size = 11), legend.text = element_text(size = 10)) +
  ylim(0,15) +
  xlim(0,150)
print(NPRatio.plot)

```

Figure 7 tells us that an increase in the N:P ratio increased dissolved oxygen in the lakes. This is consistent with the theory that controlling phosphorus concentration in phosphorus deficient lakes can can preserve their water quality. However, phosphorus might not be the only factor affecting the dissolved oxygen and eventually the water quality of water. Therefore, it is important to understand what other variables affect dissolved oxygen, whose depletion indicates eutrophication in many cases.


## Question 2: What are the best set of predictors of dissolved oxygen across the monitoring period at the North Temperate Lakes LTER? 

*Linear model*

To answer this question, a generalized linear model approach was taken.

Since multiple explanatory variables are being considered at a time in the model, it is important to check the model is not over-parameterized. Therefore, the Akaike's Information Criteria (AIC) was used. 

```{r, message=FALSE, warning=FALSE}

DO.predictors <- Combined_processed %>%
  na.exclude()

DO.AIC <- lm(data = DO.predictors, dissolvedOxygen ~ year4 + daynum + temperature_C + tn_ug + tp_ug + depth) # Runs an AIC to determine what set of explanatory variables is best suited to predict dissolved oxygen
step(DO.AIC) # The lower the AIC value, the better

```

The best predictors from the lowest AIC are: year, daynum, temperature_C, tn_ug, tp_ug and depth.

Next, a multiple regression is performed on the recommended set of variables.

```{r, message=FALSE, warning=FALSE}

DO.model <- lm(data = DO.predictors, dissolvedOxygen ~ year4 + daynum + temperature_C + depth + tn_ug + tp_ug) 
anova(DO.model)

```

The full model also reconfirmed the above variables as the best. So model is run with the same variables.

```{r, message=FALSE, warning=FALSE}

DO.model <- lm(data = DO.predictors, dissolvedOxygen ~ year4 + daynum + temperature_C + depth + tn_ug + tp_ug) # Asserts the chosen model
summary(DO.model) # Runs a multiple regression on the above recommended set of variables

```

The final set of variables that best predict the dissolved oxygen across a monitoring period are year, day number, temperature, depth, nitrogen concentration and phosphorus concentration. This set of variables explain 81% of variance (Adjusted R-squared = 0.8118, p-value < 0.001)

```{r fig8, echo=FALSE,error=FALSE,message=FALSE,warning=FALSE,fig.cap="Model diagnostic plots."}

par(mfrow = c(2, 2))
plot(DO.model)

```

The following can be said about Figure 8:

1. Residuals vs Fitted: Used to check the linear relationship assumptions. A horizontal line, without distinct patterns is an indication for a linear relationship; which is the case here.

2. Normal Q-Q: Used to examine whether the residuals are normally distributed. It’s good if residuals points follow the straight dashed line. In this case the points do appear to follow an straight line (except for the extremes which is common for environmental data), so the graph is accepted.

3. Scale-Location (or Spread-Location): Used to check the homogeneity of variance of the residuals (homoscedasticity). Horizontal line with equally spread points is a good indication of homoscedasticity. In this case, the plot is difficult to predict so we can rely on the residual vs fitted data to assure homoscedasticity.

4. Residuals vs Leverage: Used to identify influential cases, that is extreme values that might influence the regression results when included or excluded from the analysis. In this case the outliers are not so influential that leaving them out might change the structure of the model.

Given that our assumptions have been met, we can move on to the next step. From the model we got that the intercept is 59.7811180, which is the dissolved oxygen in mg/L, when all the other variables are zero. Therefore, we reject the null hypothesis of no effect of the explanatory variables on the response variable. 

The year decreases the dissolved oxygen (mg/l) in the lakes significantly. With an increase of 1 year, the dissolved oxygen is decreased by 0.0232059 mg/l (t = -3.096, df = 900, p < 0.05).

The day number decreases the dissolved oxygen (mg/l) in the lakes highly significantly. With an increase of 1 day, the dissolved oxygen is decreased by 0.0069474 mg/l (t = -3.588, df = 900, p < 0.001).

The temperature decreases the dissolved oxygen (mg/l) in the lakes highly significantly. With an increase in temperature by 1 Celsius, the dissolved oxygen is decreased by 0.1370994 mg/l (t = -6.273, df = 900, p < 0.001).

The depth decreases the dissolved oxygen (mg/l) in the lakes highly significantly. With an increase in depth by 1 meter, the dissolved oxygen is decreased by 0.8746669 mg/l (t = -25.948, df = 900, p < 0.001).

The nitrogen concentration decreases the dissolved oxygen (mg/l) in the lakes highly significantly. With an increase in nitrogen concentration by 1 µg/l, the dissolved oxygen is decreased by 0.0013804 mg/l (t = -5.738, df = 900, p < 0.001).

The phosphorus concentration increases the dissolved oxygen (mg/l) in the lakes significantly. With an increase in phosphorus concentration by 1 µg/l, the dissolved oxygen is increased by 0.0076268 mg/l (t = 2.916, df = 900, p < 0.05). 

The final linear equation to predict dissolved oxygen (mg/l) from the explanatory variables is:

**Dissolved oxygen in mg/l = 59.7811180 - 0.0232059xyear number - 0.0069474xday number - 0.1370994xtemperature in C - 0.8746669xdepth in m - 0.0013804xTN in µg/l + 0.0076268xTP in µg/l**

Figure 9 - Figure 14 offer visual presentations of the dissolve oxygen against each model variable.

```{r fig9, echo=FALSE,error=FALSE,message=FALSE,warning=FALSE,fig.cap="Dissolved oxygen vs Years."}

Year.plot <- ggplot(DO.predictors, aes(x = year4, y = dissolvedOxygen, color = lakename)) +
  geom_point(alpha = 0.75) +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  scale_color_brewer(palette = "Set1", direction = 1) +
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12,face="bold")) + 
  theme(legend.title = element_text(size = 11), legend.text = element_text(size = 10)) +
  ggtitle("Dissolved oxygen vs Model Variable 1") + # To insert the main title
  theme(plot.title = element_text(size = 13, face = "bold", hjust = 0.5)) +
  xlab("Year") + # To label the x axis
  ylab("Dissolved Oxygen (mg/l)") + # To label the y axis
  labs (color = "Lake Name") # To label the legend
print(Year.plot)

```

```{r fig10, echo=FALSE,error=FALSE,message=FALSE,warning=FALSE,fig.cap="Dissolved oxygen vs day number."}

Daynum.plot <- ggplot(DO.predictors, aes(x = daynum, y = dissolvedOxygen, color = lakename)) +
  geom_point(alpha = 0.75) +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  scale_color_brewer(palette = "Set1", direction = 1) +
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12,face="bold")) + 
    theme(legend.title = element_text(size = 11), legend.text = element_text(size = 10)) +
  ggtitle("Dissolved Oxygen vs Model Variable 2") + # To insert the main title
  theme(plot.title = element_text(size = 13, face = "bold", hjust = 0.5)) +
  theme(legend.title = element_text(size = 11), legend.text = element_text(size = 10)) +
  xlab("Day Number") + # To label the x axis
  ylab("Dissolved Oxygen (mg/l)") + # To label the y axis
  labs (color = "Lake Name") # To label the legend
print(Daynum.plot)

```

```{r fig11, echo=FALSE,error=FALSE,message=FALSE,warning=FALSE,fig.cap="Dissolved oxygen vs temperature."}

Temp.plot <- ggplot(DO.predictors, aes(x = temperature_C, y = dissolvedOxygen, color = lakename)) +
  geom_point(alpha = 0.75) +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  scale_color_brewer(palette = "Set1", direction = 1) +
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12,face="bold")) + 
    theme(legend.title = element_text(size = 11), legend.text = element_text(size = 10)) +
  ggtitle("Dissolved Oxygen vs Model Variable 3") + # To insert the main title
  theme(plot.title = element_text(size = 13, face = "bold", hjust = 0.5)) +
  theme(legend.title = element_text(size = 11), legend.text = element_text(size = 10)) +
  xlab("Temperature (C)") + # To label the x axis
  ylab("Dissolved Oxygen (mg/l)") + # To label the y axis
  labs (color = "Lake Name") + # To label the legend
  ylim(0,30)
print(Temp.plot)

```

```{r fig12, echo=FALSE,error=FALSE,message=FALSE,warning=FALSE,fig.cap="Dissolved oxygen vs depth."}

Depth.plot <- ggplot(DO.predictors, aes(x = depth, y = dissolvedOxygen, color = lakename)) +
  geom_point(alpha = 0.75) +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  scale_color_brewer(palette = "Set1", direction = 1) +
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12,face="bold")) + 
    theme(legend.title = element_text(size = 11), legend.text = element_text(size = 10)) +
  ggtitle("Dissolved Oxygen vs Model Variable 4") + # To insert the main title
  theme(plot.title = element_text(size = 13, face = "bold", hjust = 0.5)) +
  theme(legend.title = element_text(size = 11), legend.text = element_text(size = 10)) +
  xlab("Depth (m)") + # To label the x axis
  ylab("Dissolved Oxygen (mg/l)") + # To label the y axis
  labs (color = "Lake Name") + # To label the legend
  ylim (0,25)
print(Depth.plot)

```

```{r fig13, echo=FALSE,error=FALSE,message=FALSE,warning=FALSE,fig.cap="Dissolved oxygen vs nitrogen concentration."}

TN.plot <- ggplot(DO.predictors, aes(x = tn_ug, y = dissolvedOxygen, color = lakename)) +
  geom_point(alpha = 0.75) +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  scale_color_brewer(palette = "Set1", direction = 1) +
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12,face="bold")) + 
  theme(legend.title = element_text(size = 11), legend.text = element_text(size = 10)) +
  ggtitle("Dissolved Oxygen vs Model Variable 5") + # To insert the main title
  theme(plot.title = element_text(size = 13, face = "bold", hjust = 0.5)) +
  theme(legend.title = element_text(size = 11), legend.text = element_text(size = 10)) +
  xlab("Nitrogen (µg/l)") + # To label the x axis
  ylab("Dissolved Oxygen (mg/l)") + # To label the y axis
  labs (color = "Lake Name") + # To label the legend
  ylim(0, 20)
print(TN.plot)

```

```{r fig14, echo=FALSE,error=FALSE,message=FALSE,warning=FALSE,fig.cap="Dissolved oxygen vs phosphorus concentration."}

TP.plot <- ggplot(DO.predictors, aes(x = tp_ug, y = dissolvedOxygen, color = lakename)) +
  geom_point(alpha = 0.75) +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  scale_color_brewer(palette = "Set1", direction = 1) +
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12,face="bold")) + 
  theme(legend.title = element_text(size = 11), legend.text = element_text(size = 10)) +
  ggtitle("Dissolved Oxygen vs Model Variable 6") + # To insert the main title
  theme(plot.title = element_text(size = 13, face = "bold", hjust = 0.5)) +
  theme(legend.title = element_text(size = 11), legend.text = element_text(size = 10)) +
  xlab("Phosphorus (µg/l)") + # To label the x axis
  ylab("Dissolved Oxygen (mg/l)") + # To label the y axis
  labs (color = "Lake Name") + # To label the legend
  ylim(0, 20)
print(TP.plot)

```

\newpage

# Summary and Conclusions

I began this project with a set of exploratory questions that helped arrive at the necessary data analysis methods to eventually answer the the two research questions. Below are the key findings of this data analysis project stemming from key questions asked during this entire process (not just exclusive to the two main research questions or their subsets):

1. Majority of the lakes were found to be above the line of Redfield Ratio, therefore confirming that all the lakes in the dataset used were phosphorus deficient. This means that phosphorus can controlled to avoid eutrophication.

2. Most of the lakes were found to have a mean N:P ratio much above the Redfield Ratio. However, there have been instances of almost all of them having touched the Redfield Ratio.

4. The N:P ratio is found to be somewhat positively correlated to the dissolved oxygen in the lakes. However, the scatterplots show that that there is a huge spread of dissolved oxygen at especially below the ratio 50. This could mean that there are other stronger factors effecting dissolved oxygen

5. The the phosphorus concentration has decreased slowly but consistently over the years, possibly hinting at successful water quality management. Last decade has seen the phosphorus concentration controlled, below the set state criterion.

Other than the above, a major finding is that year number (possibly depicting environmental changes), day number (depicting seasonal changes), temperature, depth, nitrogen concentration and phosphorus concentration together are a good predictors of dissolved oxygen. The multiple regression model highlights several trends: increase in the year number, day number, temperature, depth and nitrogen concentration decreases dissolved oxygen significantly while increase in phosphorus concentration increases dissolved oxygen significantly. However, not all the plots (that include their respective regression line) are consistent with models results. For example, the Lm() line in the dissolved oxygen over temperature graph shows that there is a positive correlation between the tow when it is supposed to the other way around. This is not true in the real world since cold water can hold more dissolved oxygen. However, is it possible that depth has had a more major effect on this trend in this graph. Similarly, even though the model predicts that increase in phosphorus should increase dissolved oxygen, the graph shows the opposite. Once again, it is probably because there are interacting and mixed effects involved. Therefore, there is more scope for further statistical testing and analysis to confirm some of these correlations.




