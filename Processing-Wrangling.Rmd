---
title: "Processing/Wrangling"
author: "Monisha Eadala"
date: "null"
output: pdf_document
geometry: margin=2.54cm
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
# Set your working directory
setwd("~/Eadala_Project_Environmental_Data_Analytics")
# Load your packages
library(tidyverse)
library(knitr)
# Set your ggplot theme
mytheme <- theme_light(base_size = 12) +
  theme(plot.background = element_rect(fill = "grey97"),
        panel.grid.major =element_line(linetype = "dotted"),
        panel.grid.minor = element_line(linetype = "dotted"), text=element_text(size = 14, 
color = "black", face = "bold"),
        axis.text = element_text(color = "grey40"), 
        legend.position = "right",
        legend.text = element_text(color = "grey40"))
theme_set(mytheme)
# Load your datasets
Nutrients_data <- read.csv("./Data/Raw/NTL-LTER_Lake_Nutrients_Raw.csv")
O_data <- read.csv("./Data/Raw/NTL-LTER_Lake_ChemistryPhysics_Raw.csv")
head(Nutrients_data)
Nutrients_data$sampledate <- as.Date(Nutrients_data$sampledate,
format = "%m/%d/%y")

head(O_data)
O_data$sampledate <- as.Date(O_data$sampledate,
format = "%m/%d/%y")

```
# Data Wrangling
```{r}

list(unique(O_data$year4))
list(unique(Nutrients_data$year4))

Nutrients_data_processed <- Nutrients_data %>%
  select(-lakeid, -depth_id, -nh34, -po4, -no23 ,-comments) %>%
  filter(year4 == 1991 | year4 == 1992 | year4 ==  1993 | year4 ==  1994 | year4 == 1999 | year4 ==  2000 | year4 == 2001 | year4 == 2002 | year4 == 2003 | year4 == 2005 | year4 ==  2006 | year4 == 2007| year4 == 2008 | year4 == 2009 | year4 == 2010 | year4 ==  2011 | year4 ==  2012 | year4 ==  2013 | year4 ==  2014 | year4 == 2015 | year4 == 2016)
list(unique(Nutrients_data_processed$lakename))


O_data_processed <- O_data %>%
  select(-lakeid, -irradianceWater, -irradianceDeck, -comments) %>% 
  filter(year4 == 1991 | year4 == 1992 | year4 ==  1993 | year4 ==  1994 | year4 == 1999 | year4 ==  2000 | year4 == 2001 | year4 == 2002 | year4 == 2003 | year4 == 2005 | year4 ==  2006 | year4 == 2007| year4 == 2008 | year4 == 2009 | year4 == 2010 | year4 ==  2011 | year4 ==  2012 | year4 ==  2013 | year4 ==  2014 | year4 == 2015 | year4 == 2016)
list(unique(O_data_processed$lakename))

O.data.surfacedepth <- O_data %>%
  filter (depth == 0.5)

O.data.plot <- ggplot(O.data.surfacedepth, aes(x = temperature_C, y = dissolvedOxygen, color = lakename)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", se = FALSE) +
  scale_color_brewer(palette = "Set1", direction = 1) +
  ylim(0,25)
print(O.data.plot)

depth.temp.plot <- ggplot(O_data, aes(x = depth, y = temperature_C, color = lakename)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", se = FALSE) +
  scale_color_brewer(palette = "Set1", direction = 1) +
  ylim(0,25)
print(depth.temp.plot)

O.data.depth.plot <- ggplot(O_data, aes(x = depth, y = dissolvedOxygen, color = lakename)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", se = FALSE) +
  scale_color_brewer(palette = "Set1", direction = 1) +
  ylim (0,25)
print(O.data.depth.plot)

O.data.year.plot <- ggplot(O_data_processed, aes(x = year4, y = dissolvedOxygen, color = lakename)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", se = FALSE) +
  scale_color_brewer(palette = "Set1", direction = 1) +
  ylim(0,25)
print(O.data.year.plot)

Combined_data <- full_join(Nutrients_data_processed, O_data_processed) %>%
  filter(year4 == 1991 | year4 == 1992 | year4 ==  1993 | year4 ==  1994 | year4 == 1999 | year4 ==  2000 | year4 == 2001 | year4 == 2002 | year4 == 2003 | year4 == 2005 | year4 ==  2006 | year4 == 2007| year4 == 2008 | year4 == 2009 | year4 == 2010 | year4 ==  2011 | year4 ==  2012 | year4 ==  2013 | year4 ==  2014 | year4 == 2015 | year4 == 2016) %>%
  filter(lakename == "Paul Lake" | lakename == "Peter Lake" | lakename == "East Long Lake" | lakename == "West Long Lake" | lakename == "Tuesday Lake" | lakename == "Central Long Lake" | lakename == "Hummingbird Lake" | lakename == "Crampton Lake")
list(unique(Combined_data$lakename))

write.csv(Combined_data, row.names = FALSE, file = "./Data/Processed/Combined_data.csv")

```

# Research question 1: What are the best set of predictors of dissolved oxygen across the monitoring period at the North Temperate Lakes LTER

```{r}
Lakes <- Combined_data %>%
  dplyr::mutate(year = lubridate::year(sampledate), 
                month = lubridate::month(sampledate), 
                day = lubridate::day(sampledate)) %>%
  select(-year4) %>%
  na.exclude()

DOxygen.AIC <- lm(data = Lakes, dissolvedOxygen ~ year + day + month + temperature_C + tn_ug + tp_ug + depth) # Runs an AIC to determine what set of explanatory variables is best suited to predict dissolved oxygen
step(DOxygen.AIC) # Confirms that I should be the variables that are correspnd to the model with the lowest AIC; Which means the best predictors are year4, temperature_C, and depth_id

DOxygen.model <- lm(data = Lakes, dissolvedOxygen ~ year + day + month + temperature_C + tn_ug + tp_ug + depth) 
anova(DOxygen.model) # 

DOxygen.model <- lm(data = Lakes, dissolvedOxygen ~ year + month + day + temperature_C + depth + tn_ug + tp_ug) # Asserts the chosen model
summary(DOxygen.model) # Runs a multiple regression on the above recommended set of variables and confirms that variables 

temp.plot <- ggplot(Lakes, aes(x = temperature_C, y = dissolvedOxygen, color = lakename)) +
  geom_point(0.75) +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  scale_color_brewer(palette = "Set1", direction = 1) +
  ylim(0,30)
print(temp.plot)


Depth.plot <- ggplot(Lakes, aes(x = depth, y = dissolvedOxygen, color = lakename)) +
  geom_point(alpha = 0.75) +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  scale_color_brewer(palette = "Set1", direction = 1) +
  ylim (0,25)
print(Depth.plot)

Year.plot <- ggplot(Lakes, aes(x = year, y = dissolvedOxygen, color = lakename)) +
  geom_point(alpha = 0.75) +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  scale_color_brewer(palette = "Set1", direction = 1) 
print(Year.plot)

Month.plot <- ggplot(Lakes, aes(x = month, y = dissolvedOxygen, color = lakename)) +
  geom_point(alpha = 0.75) +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  scale_color_brewer(palette = "Set1", direction = 1) 
print(Month.plot)

Day.plot <- ggplot(Lakes, aes(x = day, y = dissolvedOxygen, color = lakename)) +
  geom_point(alpha = 0.75) +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  scale_color_brewer(palette = "Set1", direction = 1) 
print(Day.plot)

TN.plot <- ggplot(Lakes, aes(x = tn_ug, y = dissolvedOxygen, color = lakename)) +
  geom_point(alpha = 0.75) +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  scale_color_brewer(palette = "Set1", direction = 1) +
  ylim(0, 20)
print(TN.plot)

TP.plot <- ggplot(Lakes, aes(x = tp_ug, y = dissolvedOxygen, color = lakename)) +
  geom_point(alpha = 0.75) +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  scale_color_brewer(palette = "Set1", direction = 1) +
  ylim(0, 20)
print(TP.plot)

DOxyggen.ancova.interaction <- lm(data = Lakes, dissolvedOxygen ~ lakename * temperature_C)
summary(DOxyggen.ancova.interaction)
```

# Research question 2: Wwhat is the average nitrogen:phosphorus ratio for the eight north temperate lakes at depth below 1 meter? What relationship does the average ratio for all lakes have on their average dissolved oxygen? Are the lakes phosphorus or nitrogen deficient? 

```{r}
NitrogenPhosphorus <- Combined_data %>%
  select(-temperature_C) %>%
  filter (depth < 1) %>%
  na.exclude()

NitrogenPhosphorus$NPRatio <- NitrogenPhosphorus$tn_ug / NitrogenPhosphorus$tp_ug

NPRatio.summary <- NitrogenPhosphorus %>%
   group_by(lakename) %>%
  summarise(mean.NPRatio = mean(NPRatio, na.rm = TRUE),
            minimum.NPRatio = min(NPRatio, na.rm = TRUE),
            maximum.NPRatio = max(NPRatio, na.rm = TRUE),
            Standard.dev.NPRatio = sd(NPRatio, na.rm = TRUE))

NPRatio.boxplot <- ggplot(NitrogenPhosphorus, aes(x = depth, y = NPRatio)) +
  geom_boxplot(aes(color = lakename)) +
  scale_color_brewer(palette = "Set1", direction = 1) +
  ylim(0,200)
print(NPRatio.boxplot) 

NPRatio.boxplot2 <- ggplot(NitrogenPhosphorus, aes(x = depth, y = NPRatio)) +
  geom_boxplot(color = "blue") +
  scale_color_brewer(palette = "Set1", direction = 1) +
  ylim(0,200)
print(NPRatio.boxplot2) 

NP.plot <- ggplot(NitrogenPhosphorus, aes(x = tp_ug, y = tn_ug, color = lakename)) +
  geom_point(alpha = 0.75) +
  geom_abline(slope = 16, intercept = 0, linetype = "dashed") +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  scale_color_brewer(palette = "Set1", direction = 1) +
  xlim(0,65)
print(NP.plot) # Gives the N vs P plot

NP.plot2 <- ggplot(NitrogenPhosphorus, aes(x = tp_ug, y = tn_ug, color = lakename)) +
  geom_point(alpha = 0.75) +
  geom_smooth(method = "lm", se = FALSE) +
  geom_abline(slope = 16, intercept = 0, linetype = "dashed") +
  scale_color_brewer(palette = "Set1", direction = 1) +
  xlim(0,65)
print(NP.plot2) # Gives the N vs P plot

NPRatio.plot <- ggplot(NitrogenPhosphorus, aes(x = NPRatio, y = dissolvedOxygen, color = lakename)) +
  geom_point(alpha = 0.75) +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  scale_color_brewer(palette = "Set1", direction = 1) +
  ylim(0,15) +
  xlim(0,150)
print(NPRatio.plot) 
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
