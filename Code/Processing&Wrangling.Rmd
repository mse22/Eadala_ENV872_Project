---
title: "processing/wrangling"
output: html_document
---

```{r setup, include=FALSE}
# Set your working directory
setwd("~/Environmental_Data_Analytics_2020")
# Load your packages
library(tidyverse)
library(knitr)
# Set your ggplot theme
mytheme <- theme_light(base_size = 12) +
  theme(plot.background = element_rect(fill = "grey97"),
        panel.grid.major =element_line(linetype = "dotted"),
        panel.grid.minor = element_line(linetype = "dotted"), text=element_text(size = 14, 
color = "black", face = "bold"),
        axis.text = element_text(color = "grey40"), 
        legend.position = "right",
        legend.text = element_text(color = "grey40"))
theme_set(mytheme)
# Load your datasets
Nutrients_data <- read.csv("./Data/Raw/NTL-LTER_Lake_Nutrients_Raw.csv")
DIC_data <- read.csv("./Data/Raw/NTL-LTER_Lake_Carbon_Raw.csv")
O_data <- read.csv("./Data/Raw/NTL-LTER_Lake_ChemistryPhysics_Raw.csv")

head(Nutrients_data)
Nutrients_data$sampledate <- as.Date(Nutrients_data$sampledate,
format = "%m/%d/%y")

head(DIC_data)
DIC_data$sampledate <- as.Date(DIC_data$sampledate,
format = "%m/%d/%y")

head(O_data)
O_data$sampledate <- as.Date(O_data$sampledate,
format = "%m/%d/%y")

Nutrients_data_processed <- Nutrients_data %>%
  select(-lakeid,-depth_id,-comments) %>%
  filter(depth == 0)

DIC_data_processed <- DIC_data %>%
  select(-lakeid,-depth_id) %>%
  filter(depth == 0)

O_data_processed <- O_data %>%
  select(-lakeid, -comments) %>%
  filter(depth == 0)


class(Nutrients_data_processed$depth)
class(DIC_data_processed$depth)
DIC_data_processed$depth <- as.numeric(DIC_data_processed$depth)
class(DIC_data_processed$depth)

Combined_data <- full_join(Nutrients_data_processed, DIC_data_processed)


Nutrients_summary.tn <- Nutrients_data_processed %>%
  group_by(lakename) %>%
  summarise(mean.tn_ug = mean(tn_ug, na.rm = TRUE),
            minimum.tn_ug = min(tn_ug, na.rm = TRUE),
            maximum.tn_ug = max(tn_ug, na.rm = TRUE),
            Standard.dev.tn_ug = sd(tn_ug, na.rm = TRUE))

Nutrients_summary.tp <- Nutrients_data_processed %>%
   group_by(lakename) %>%
  summarise(mean.tp_ug = mean(tp_ug, na.rm = TRUE),
            minimum.tp_ug = min(tp_ug, na.rm = TRUE),
            maximum.tp_ug = max(tp_ug, na.rm = TRUE),
            Standard.dev.tp_ug = sd(tp_ug, na.rm = TRUE))

kable(Nutrients_summary.tn, caption = "Total Nitrogen conentrations per Lake")
kable(Nutrients_summary.tp, caption = "Total Phosporous conentrations per Lake")

library(scales)
ggplot(Nutrients_data_processed, aes(x = as.POSIXct(sampledate), y = tp_ug, color = lakename)) +
  geom_point() +
  scale_color_brewer(palette="Dark2") +
  xlab("Date (year)") +
  ylab("Total Phosphorus (\U003BCg/L)") +
  scale_x_datetime(date_breaks = "1 year", labels = date_format("%Y"))

year1991_Nutrients_data_processed <- Nutrients_data %>%
  select(-lakeid,-depth_id,-comments) %>%
  filter(depth == 0, year4 ==1991)

year1991.summary.tp <- year1991_Nutrients_data_processed %>%
  group_by(lakename) %>%
  summarise(mean.tp_ug = mean(tp_ug, na.rm = TRUE),
            minimum.tp_ug = min(tp_ug, na.rm = TRUE),
            maximum.tp_ug = max(tp_ug, na.rm = TRUE),
            Standard.dev.tp_ug = sd(tp_ug, na.rm = TRUE))

year1999_Nutrients_data_processed <- Nutrients_data %>%
  select(-lakeid,-depth_id,-comments) %>%
  filter(depth == 0, year4 ==1999)

year1999.summary.tp <- year1999_Nutrients_data_processed %>%
  group_by(lakename) %>%
  summarise(mean.tp_ug = mean(tp_ug, na.rm = TRUE),
            minimum.tp_ug = min(tp_ug, na.rm = TRUE),
            maximum.tp_ug = max(tp_ug, na.rm = TRUE),
            Standard.dev.tp_ug = sd(tp_ug, na.rm = TRUE))

year1995_Nutrients_data_processed <- Nutrients_data %>%
  select(-lakeid,-depth_id,-comments) %>%
  filter(depth == 0, year4 ==1995)

year1995.summary.tp <- year1995_Nutrients_data_processed %>%
  group_by(lakename) %>%
  summarise(mean.tp_ug = mean(tp_ug, na.rm = TRUE),
            minimum.tp_ug = min(tp_ug, na.rm = TRUE),
            maximum.tp_ug = max(tp_ug, na.rm = TRUE),
            Standard.dev.tp_ug = sd(tp_ug, na.rm = TRUE))

Nutrients_data_processed$NPRatio <- Nutrients_data_processed$tn_ug / Nutrients_data_processed$tp_ug

Nutrients_summary.ratio <- Nutrients_data_processed %>%
   group_by(lakename) %>%
  summarise(mean.NPRatio = mean(NPRatio, na.rm = TRUE),
            minimum.NPRatio = min(NPRatio, na.rm = TRUE),
            maximum.NPRatio = max(NPRatio, na.rm = TRUE),
            Standard.dev.NPRatio = sd(NPRatio, na.rm = TRUE))

list(unique(Nutrients_data$depth_id))
class(Nutrients_data$comments)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
